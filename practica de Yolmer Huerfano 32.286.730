#include <stdio.h>
#include <string.h>
#include <ctype.h>
#include <windows.h> 
HANDLE hConsole;

void set_console_color(WORD color) {
    SetConsoleTextAttribute(hConsole, color);
}

void reset_console_color() {
    SetConsoleTextAttribute(hConsole, FOREGROUND_RED | FOREGROUND_GREEN | FOREGROUND_BLUE);
}

int main() {
  
    hConsole = GetStdHandle(STD_OUTPUT_HANDLE);
    if (hConsole == INVALID_HANDLE_VALUE) {
        fprintf(stderr, "Error al obtener el handle de la consola. No se aplicar√°n colores.\n");
 
    }

    int numeroDeLibros;
    int i = 0;

    printf("Ingrese el numero de libros a cargar: ");
    scanf("%d", &numeroDeLibros);
    getchar();

    char titulo[numeroDeLibros][50];
    char autor[numeroDeLibros][50];
    char genero[numeroDeLibros][30];
    char codigoIsbn[numeroDeLibros][11];
    int  stock[numeroDeLibros];
    float precio[numeroDeLibros];
    float ganancia[numeroDeLibros];

    printf("\n CARGA DE DATOS \n");

    for (i = 0; i < numeroDeLibros; i++) {
        printf("\n--- Libro %d ---\n", i + 1);

        printf("Ingrese el titulo del libro: ");
        scanf(" %[^\n]s", titulo[i]);

        for (int j = 0; titulo[i][j] != '\0'; j++) {
            titulo[i][j] = toupper((unsigned char)titulo[i][j]);
        }

        printf("Ingrese el autor del libro: ");
        scanf(" %[^\n]s", autor[i]);

        for (int j = 0; autor[i][j] != '\0'; j++) {
            autor[i][j] = toupper((unsigned char)autor[i][j]);
        }

        printf("Ingrese el genero del libro: ");
        scanf(" %[^\n]s", genero[i]);

        for (int j = 0; genero[i][j] != '\0'; j++) {
            genero[i][j] = toupper((unsigned char)genero[i][j]);
        }

        while (1) {
            printf("Ingrese el ISBN del libro (debe tener 10 digitos): ");
            scanf("%s", codigoIsbn[i]);

            for (int j = 0; codigoIsbn[i][j] != '\0'; j++) {
                codigoIsbn[i][j] = toupper((unsigned char)codigoIsbn[i][j]);
            }
            if (strlen(codigoIsbn[i]) == 10) {
                break;
            } else {
                printf("ERROR: El codigo ISBN debe tener exactamente 10 digitos.\n");
            }
        }
        getchar();

        while (1) {
            printf("Ingrese el precio del libro: ");
            scanf("%f", &precio[i]);
            if (precio[i] >= 0) {
                break;
            } else {
                printf("ERROR: El precio del libro no puede ser negativo. Por favor, ingrese un valor valido.\n");
            }
        }

        printf("Ingrese la cantidad en stock del libro: ");
        scanf("%d", &stock[i]);

        ganancia[i] = precio[i] * stock[i];

        printf("Libro cargado con exito.\n");
    }

    printf("\n Resumen de Libros y Ganancias \n");

    printf("\n%-30s %-20s %-15s %-12s %-10s %-8s %-15s\n",
           "Titulo", "Autor", "Genero", "ISBN", "Precio", "Stock", "Ganancia Total");
    printf("\n");

    for (i = 0; i < numeroDeLibros; i++) {
        printf("%-30s %-20s %-15s %-12s %-10.2f %-8d ",
               titulo[i], autor[i], genero[i], codigoIsbn[i], precio[i], stock[i]);

        if (ganancia[i] < 0) {
            set_console_color(FOREGROUND_RED | FOREGROUND_INTENSITY); 
            printf("%-15.2f\n", ganancia[i]);
            reset_console_color();
        } else {
            set_console_color(FOREGROUND_GREEN | FOREGROUND_INTENSITY); 
            printf("%-15.2f\n", ganancia[i]);
            reset_console_color(); 
        }
    }
    printf("\n");

    char buscadorISBN[11];
    printf("\n Busqueda de Libros por ISBN \n");
    printf("Ingrese el ISBN del libro a buscar: ");
    scanf(" %s", buscadorISBN);

    for (int j = 0; buscadorISBN[j] != '\0'; j++) {
        buscadorISBN[j] = toupper((unsigned char)buscadorISBN[j]);
    }

    printf("\nResultados de la Busqueda para el ISBN \"%s\":\n", buscadorISBN);
    printf("\n");
    int found = 0;
    for (i = 0; i < numeroDeLibros; i++) {

        if (strcmp(codigoIsbn[i], buscadorISBN) == 0) {
            printf("%-30s %-20s %-15s %-12s $ %.2f USD | STOCK: %d\n",
                   titulo[i], autor[i], genero[i], codigoIsbn[i], precio[i], stock[i]);
            found = 1;
            break;
        }
    }

    if (!found) {
        printf("No se encontro ningun libro con el ISBN \"%s\".\n", buscadorISBN);
    }
    printf("\n");

    return 0;
}
